<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Celebra√ß√£o - Login Seguro</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif; }
body { min-height:100vh; background:linear-gradient(135deg,#ff8a00 0%,#ffb347 50%,#ffd194 100%); padding:30px 16px; }
.container { max-width:1000px; margin:auto; text-align:center; }
.title { font-size:64px; font-weight:900; color:#fff; margin-bottom:35px; letter-spacing:-2px; text-shadow:0 2px 10px rgba(0,0,0,0.1); }
.login-section { background:#fff; border-radius:20px; padding:40px 30px; box-shadow:0 20px 40px rgba(0,0,0,0.1); max-width:380px; margin:auto; }
.login-title { font-size:24px; font-weight:800; margin-bottom:28px; color:#1f2937; }
.login-form { display:flex; flex-direction:column; gap:18px; }
.form-label { font-size:14px; font-weight:600; text-align:left; color:#374151; }
.form-input { padding:14px 16px; border-radius:12px; border:2px solid #e5e7eb; font-size:16px; transition:all 0.3s; }
.form-input:focus { outline:none; border-color:#fb923c; box-shadow:0 0 0 4px rgba(251,146,60,0.1); }
.btn { border:none; border-radius:12px; padding:16px; font-size:16px; font-weight:700; cursor:pointer; color:#fff; text-decoration:none; display:block; margin-top:12px; transition:all 0.3s; }
.login-btn { background:linear-gradient(135deg,#fb923c,#f97316); box-shadow:0 4px 15px rgba(251,146,60,0.4); }
.login-btn:hover { transform:translateY(-2px); box-shadow:0 8px 25px rgba(251,146,60,0.5); }
.error-message { color:#dc2626; font-size:14px; display:none; margin-top:12px; padding:10px; background:#fee2e2; border-radius:8px; border-left:4px solid #dc2626; }
.loading { color:#fb923c; font-size:14px; display:none; margin-top:12px; font-weight:500; }
.user-section { background:#fff; border-radius:20px; padding:40px 30px; box-shadow:0 20px 40px rgba(0,0,0,0.1); max-width:500px; margin:auto; text-align:center; display:none; }
.section-title { font-size:24px; font-weight:800; margin-bottom:28px; color:#1f2937; }
.user-info { background:linear-gradient(135deg,#fff7ed,#fed7aa); border:2px solid #fbbf24; border-radius:16px; padding:20px; margin:24px auto; max-width:380px; text-align:left; font-size:15px; }
.user-info strong { color:#c2410c; }
.btn-small { font-size:14px; padding:12px 20px; margin:6px; display:inline-block; }
.logout-btn { background:#ef4444; }
.send-btn { background:linear-gradient(135deg,#fb923c,#f97316); box-shadow:0 4px 15px rgba(251,146,60,0.4); }
.send-btn:hover { transform:translateY(-2px); box-shadow:0 8px 25px rgba(251,146,60,0.5); }
.warning { background:#fef3c7; border:2px solid #f59e0b; border-radius:16px; padding:24px; margin:30px auto; max-width:450px; text-align:left; font-size:15px; }
.warning strong { color:#b45309; }
.users-hint { background:#f3f4f6; border-radius:12px; padding:16px; margin-top:20px; font-size:13px; color:#6b7280; }
@media(max-width:600px) { .title { font-size:48px; margin-bottom:25px; } .login-section { margin:20px 10px; padding:30px 20px; } }
</style>
</head>
<body>
<div class="container">
  <div class="title">üéâ CELEBRA√á√ÉO</div>
  
  <!-- LOGIN -->
  <div class="login-section" id="loginSection">
    <h2 class="login-title">üîê Acesso Restrito</h2>
    <form class="login-form" id="loginForm">
      <label class="form-label">üë§ Usu√°rio</label>
      <input id="username" class="form-input" placeholder="abner" required>
      <label class="form-label">üîí Senha</label>
      <input id="password" type="password" class="form-input" placeholder="12345" required>
      <button type="submit" class="btn login-btn">üöÄ Entrar na Celebra√ß√£o</button>
      <p class="loading" id="loginLoading">üîÑ Conectando com o servidor...</p>
      <p class="error-message" id="errorMessage"></p>
    </form>
    <div class="users-hint">
      <strong>üí° Usu√°rios:</strong> abner | maria | joao<br>
      <strong>Senha padr√£o:</strong> 12345
    </div>
  </div>

  <!-- √ÅREA LOGADA -->
  <div class="user-section" id="userSection">
    <h2 class="section-title">‚úÖ <span id="userName"></span> - Acesso Liberado!</h2>
    <div class="user-info">
      <p><strong>‚úì Autentica√ß√£o bem-sucedida</strong></p>
      <p>üë§ Usu√°rio: <strong id="userDisplay"></strong></p>
      <p>üì± IP: <strong id="userIP"></strong></p>
    </div>
    
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSeVA_IrvRJr7cG6z1RCwzxRhI2WNvi-lI7U0oN96mFmq6awsA/viewform" 
       class="btn send-btn" target="_blank">üì∏ Enviar Fotos da Celebra√ß√£o</a>

    <div class="warning">
      <span style="color:#f59e0b;font-size:24px;margin-right:12px;float:left;margin-top:2px;">‚ö†Ô∏è</span>
      <div>
        <strong>üìã Importante:</strong><br>
        Envie suas fotos pelo formul√°rio acima para registrarmos todos os momentos inesquec√≠veis desta celebra√ß√£o!
      </div>
    </div>

    <button class="btn logout-btn btn-small" id="logoutBtn">üö™ Sair</button>
  </div>
</div>

<script>
class CelebraLogin {
  constructor() {
    // üî• COLE AQUI A URL DO RENDER DEPOIS:
    this.API_URL = 'https://adtemplocentralriachodoce-bit.onrender.com/api';
  }

  async request(endpoint, options = {}) {
    try {
      const response = await fetch(`${this.API_URL}${endpoint}`, {
        method: options.method || 'GET',
        headers: { 'Content-Type': 'application/json' },
        body: options.body ? JSON.stringify(options.body) : null,
        credentials: 'omit'
      });
      return await response.json();
    } catch (error) {
      throw new Error('‚ùå Backend indispon√≠vel. Aguarde alguns minutos.');
    }
  }

  async login(username, password) {
    const result = await this.request('/login', {
      method: 'POST',
      body: { username, password }
    });
    
    if (result.success) {
      localStorage.setItem('user', username);
      return result.user;
    }
    throw new Error(result.message || 'Usu√°rio ou senha incorretos');
  }
}

const auth = new CelebraLogin();

// ELEMENTOS DOM
const loginSection = document.getElementById('loginSection');
const userSection = document.getElementById('userSection');
const userName = document.getElementById('userName');
const userDisplay = document.getElementById('userDisplay');
const userIP = document.getElementById('userIP');
const loginLoading = document.getElementById('loginLoading');
const errorMessage = document.getElementById('errorMessage');

// PEGA IP DO USU√ÅRIO
async function getUserIP() {
  try {
    const response = await fetch('https://api.ipify.org?format=json');
    const data = await response.json();
    return data.ip;
  } catch {
    return 'Detectando...';
  }
}

// LOGIN
document.getElementById('loginForm').onsubmit = async (e) => {
  e.preventDefault();
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  
  // VALIDA√á√ÉO B√ÅSICA
  if (!username || !password) {
    errorMessage.textContent = 'Preencha usu√°rio e senha!';
    errorMessage.style.display = 'block';
    return;
  }
  
  loginLoading.style.display = 'block';
  errorMessage.style.display = 'none';
  
  try {
    const user = await auth.login(username, password);
    const ip = await getUserIP();
    this.API_URL = 'https://adtemplocentralriachodoce-bit.onrender.com/api';
    userDisplay.textContent = username;
    userName.textContent = username;
    userIP.textContent = ip;
    
    loginSection.style.display = 'none';
    userSection.style.display = 'block';
  } catch (error) {
    errorMessage.textContent = error.message;
    errorMessage.style.display = 'block';
  } finally {
    loginLoading.style.display = 'none';
  }
};

// SAIR
document.getElementById('logoutBtn').onclick = () => {
  localStorage.removeItem('user');
  loginSection.style.display = 'block';
  userSection.style.display = 'none';
  document.getElementById('loginForm').reset();
  document.getElementById('username').focus();
};
</script>
</body>
</html>
